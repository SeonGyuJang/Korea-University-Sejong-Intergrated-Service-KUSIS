{# templates/fragments/_post_card.html #}
<article class="post-card" data-post-id="{{ post.id }}">
    
    {# --- 카드 헤더: 작성자 정보 (변경 없음) --- #}
    <header class="post-card-header">
        <div class="post-author-avatar">
            {% if post.author.permission == 'admin' %}
                <i class="fas fa-shield-alt" title="관리자"></i>
            {% elif post.author.permission == 'associate' %}
                <i class="fas fa-user-tie" title="협력회원"></i>
            {% else %}
                <i class="fas fa-user"></i>
            {% endif %}
        </div>
        <div class="post-author-info">
            <span class="post-author-name">{{ post.author.name }}</span>
            <span class="post-timestamp">{{ post.created_at | kst }} (KST)</span>
        </div>
    </header>

    {# --- 카드 본문: [수정] 제목을 링크로 변경, 내용에 preview 클래스 추가 --- #}
    <div class="post-card-body">
        {# 제목을 클릭하면 상세 페이지로 이동 #}
        <a href="{{ url_for('view_post', post_id=post.id) }}" class="post-card-title-link">
            <h2 class="post-card-title">{{ post.title }}</h2>
        </a>
        
        {# 긴 내용은 CSS로 인해 일부만 보이고 생략됨 #}
        <div class="post-card-content-preview">
            {{ post.content | safe }}
        </div>
        
        {# --- 이미지 갤러리 --- #}
        {% set image_list = post.image_filenames.split(',') if post.image_filenames else [] %}
        {% if image_list %}
            {# [수정] 이미지 클릭 시 상세 페이지로 이동하는 링크 추가 #}
            <a href="{{ url_for('view_post', post_id=post.id) }}" class="post-card-images-link">
                <div class="post-card-images cols-{{ image_list|length if image_list|length <= 3 else 3 }}">
                    {% for filename in image_list %}
                    <img src="{{ url_for('uploaded_file', filename=filename) }}" alt="{{ post.title }} 이미지" class="post-card-image">
                    {% endfor %}
                </div>
            </a>
        {% endif %}
    </div>

    {# --- 카드 액션: [수정] flex-grow: 1로 본문 영역을 밀어내도록 함 --- #}
    <footer class="post-card-actions">
        <div>
            {# --- 좋아요 버튼 --- #}
            {% set user_liked = post.id in user_likes %}
            <button class="action-button like-btn {{ 'liked' if user_liked else '' }}" data-post-id="{{ post.id }}">
                <i class="fas fa-heart"></i>
                <span class="like-count">{{ post.likes.count() }}</span>
            </button>
            {# --- 댓글 버튼 --- #}
            <button class="action-button comment-btn" data-post-id="{{ post.id }}">
                <i class="fas fa-comment-alt"></i>
                <span class="comment-count">{{ post.comments.count() }}</span>
            </button>
        </div>
        {# --- 공유 버튼 --- #}
        <button class="action-button share-btn" data-post-id="{{ post.id }}">
            <i class="fas fa-share-alt"></i>
            <span>공유</span>
        </button>
    </footer>

    {# --- 댓글 섹션 (숨겨져 있음) --- #}
    <div class="comment-section" style="display: none;">
        <div class="comment-section-content" id="comment-list-{{ post.id }}">
            {# JS로 채워짐 #}
        </div>
        <form class="comment-input-form" data-post-id="{{ post.id }}">
            <input type="text" class="comment-input" placeholder="댓글을 입력하세요..." required>
            <button type="submit" class="comment-submit-btn" title="댓글 등록">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>
</article>