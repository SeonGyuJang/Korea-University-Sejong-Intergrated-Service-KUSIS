{% extends "base.html" %}

{% block title %}KUSIS - 커뮤니티{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/community.css') }}">
{% endblock %}

{% block content %}
<div class="content-area community-page">
    <div class="community-container">
        
        {# --- [수정] 헤더 -> 카테고리 탭 메뉴 + 새 글 작성 버튼 --- #}
        <header class="community-header">
            <div class="community-tabs">
                {# '전체' 탭 #}
                <a href="{{ url_for('community_feed', category='all') }}" 
                   class="tab-item {% if selected_category == 'all' %}active{% endif %}">
                    <i class="fas fa-layer-group"></i>
                    <span>전체</span>
                </a>
                
                {# 카테고리별 탭 동적 생성 #}
                {% set category_icons = {'공지': 'fas fa-bullhorn', '홍보': 'fas fa-ad', '안내': 'fas fa-info-circle', '업데이트': 'fas fa-sync-alt', '일반': 'fas fa-comment-alt'} %}
                {% for category in post_categories %}
                <a href="{{ url_for('community_feed', category=category) }}" 
                   class="tab-item {% if selected_category == category %}active{% endif %}">
                    <i class="{{ category_icons.get(category, 'fas fa-comment-alt') }}"></i>
                    <span>{{ category }}</span>
                </a>
                {% endfor %}
            </div>
            
            {# 새 글 작성 버튼 (권한 확인) #}
            {% if user and user.can_manage_posts %}
            <a href="{{ url_for('create_post') }}" class="btn-new-post" title="새 게시물 작성">
                <i class="fas fa-plus"></i>
                <span class="btn-new-post-text">새 글 작성</span>
            </a>
            {% endif %}
        </header>
        {# --- 수정 끝 --- #}

        {# --- 피드 그리드 (변경 없음) --- #}
        <div class="community-grid" id="communityFeed">
            
            {% if posts %}
                {% for post in posts %}
                    {# post_card.html 템플릿을 인클루드합니다. #}
                    {% include 'fragments/_post_card.html' %}
                {% else %}
                <div class="widget community-empty-message">
                    <i class="fas fa-inbox"></i>
                    <p>선택한 카테고리에 게시물이 없습니다.</p>
                    {% if user and user.can_manage_posts %}
                    <p>새로운 게시물을 작성해보세요!</p>
                    {% endif %}
                </div>
                {% endfor %}
            {% endif %}

        </div>
        {# --- 피드 끝 --- #}

    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/community.js') }}"></script>
{% endblock %}