{% extends "base.html" %}

{% block title %}KUSIS - 커뮤니티{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/community.css') }}">
{% endblock %}

{% block content %}
<div class="content-area community-page">
    {# --- [수정] 전체 너비를 사용하는 .community-container로 변경 --- #}
    <div class="community-container">
        
        {# --- [수정] 헤더에 '새 글 작성' 버튼 추가 (권한 확인) --- #}
        <header class="community-header">
            <h3><i class="fas fa-users"></i> 커뮤니티 피드</h3>
            
            {# --- [수정 1, 2] 관리자/협력회원에게만 버튼 표시 --- #}
            {% if user and user.can_manage_posts %}
            <a href="{{ url_for('create_post') }}" class="btn-new-post">
                <i class="fas fa-plus"></i> 새 게시물 작성
            </a>
            {% endif %}
            {# --- 수정 끝 --- #}
            
        </header>

        {# --- [수정] 피드 컨테이너를 .community-grid로 변경 (CSS에서 그리드 적용) --- #}
        <div class="community-grid" id="communityFeed">
            
            {% if posts %}
                {% for post in posts %}
                    {# post_card.html 템플릿을 인클루드합니다. #}
                    {% include 'fragments/_post_card.html' %}
                {% else %}
                <div class="widget community-empty-message">
                    <i class="fas fa-inbox"></i>
                    <p>아직 승인된 게시물이 없습니다.</p>
                    {% if user and user.can_manage_posts %} {# [수정] 권한이 있을 때만 작성 유도 #}
                    <p>첫 번째 게시물을 작성해보세요!</p>
                    {% endif %}
                </div>
                {% endfor %}
            {% endif %}

        </div>
        {# --- 피드 끝 --- #}

    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/community.js') }}"></script>
{% endblock %}