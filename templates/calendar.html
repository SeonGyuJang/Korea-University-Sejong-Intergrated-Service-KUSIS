{% extends "base.html" %}

{% block title %}캘린더 - KUSIS{% endblock %}

{% block styles %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
{% endblock %}

{% block content %}
<div class="notion-calendar-container">
    <div class="calendar-sidebar">
        <div class="mini-calendar-wrapper">
            <div class="mini-calendar-header">
                <button class="mini-nav-btn" id="miniPrevMonth">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="mini-calendar-title" id="miniCalendarTitle">2025년 10월</span>
                <button class="mini-nav-btn" id="miniNextMonth">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div id="miniCalendar" class="mini-calendar"></div>
            <button class="today-btn" id="todayBtn">
                <i class="fas fa-calendar-day"></i> 오늘
            </button>
        </div>

        <div class="sidebar-section">
            <div class="section-header">
                <h3>내 캘린더</h3>
                <button class="icon-btn" id="addCategoryBtn" title="카테고리 추가">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="category-list" id="categoryList">
                </div>
        </div>
    </div>

    <div class="calendar-main">
        <div class="calendar-toolbar">
            <div class="toolbar-left">
                <h1 class="calendar-main-title" id="calendarMainTitle">2025년 10월</h1>
            </div>
            <div class="toolbar-right">
                <div class="view-switcher">
                    <button class="view-btn" data-view="dayGridMonth">월</button>
                    <button class="view-btn active" data-view="timeGridWeek">주</button>
                    <button class="view-btn" data-view="timeGridDay">일</button>
                </div>
            </div>
        </div>

        <div id="calendar" class="main-calendar"></div>
    </div>

    <div class="side-panel" id="sidePanel"> {# --- 수정: always-visible 클래스 제거 --- #}
        <div class="panel-default-view" id="panelDefaultView">
            <div class="side-panel-header">
                <h2>📌 바로가기</h2>
            </div>
            <div class="side-panel-body">
                <div class="shortcuts-section">
                    <h3>⌨️ 키보드 단축키</h3>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                            <kbd>N</kbd>
                            <span>새 일정</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>T</kbd>
                            <span>오늘로 이동</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>W</kbd>
                            <span>주간 뷰</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>M</kbd>
                            <span>월간 뷰</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>D</kbd>
                            <span>일간 뷰</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>←</kbd> <kbd>→</kbd>
                            <span>이전/다음</span>
                        </div>
                        {# --- 수정: 사이드바 토글 단축키 설명 업데이트 (Backslash 명시) --- #}
                        <div class="shortcut-item">
                            <kbd>\</kbd>
                            <span>좌측 사이드바 열기/닫기</span>
                        </div>
                        {# --- 수정 끝 --- #}
                        <div class="shortcut-item">
                             <kbd>ESC</kbd>
                            <span>패널/모달 닫기</span>
                        </div>
                    </div>
                </div>

                <div class="tips-section">
                    <h3>💡 사용 팁</h3>
                    <ul class="tips-list">
                        <li>빈 시간을 <strong>드래그</strong>하여 일정 생성</li>
                        <li>일정을 <strong>드래그</strong>하여 이동</li>
                        <li>일정 경계를 <strong>드래그</strong>하여 시간 조절</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="panel-edit-view" id="panelEditView" style="display: none;">
            <div class="side-panel-header">
                <h2>일정 정보</h2>
                <button class="icon-btn close-panel-btn" id="closePanelBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="side-panel-body">
                <form id="eventForm">
                <input type="hidden" id="eventId">

                <div class="form-field">
                    <input type="text" id="eventTitle" class="title-input" placeholder="일정 제목 입력" required>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-tag"></i>
                        카테고리
                    </label>
                    <select id="eventCategory" class="field-select" required>
                        </select>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-clock"></i>
                        날짜 및 시간
                    </label>
                    <label class="checkbox-label" style="margin-bottom: 10px;">
                        <input type="checkbox" id="eventAllDay" checked>
                        <span>종일</span>
                    </label>
                    <div class="date-time-grid">
                        <input type="date" id="eventStartDate" class="field-input" placeholder="시작 날짜" required>
                        <input type="time" id="eventStartTime" class="field-input time-input" placeholder="시작 시간" style="display: none;">
                        <input type="date" id="eventEndDate" class="field-input" placeholder="종료 날짜 (선택)">
                        <input type="time" id="eventEndTime" class="field-input time-input" placeholder="종료 시간" style="display: none;">
                    </div>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-redo"></i>
                        반복
                    </label>
                    <select id="eventRecurrence" class="field-select">
                        <option value="">반복 안 함</option>
                        <option value="daily">매일</option>
                        <option value="weekly">매주</option>
                        <option value="monthly">매월</option>
                        <option value="yearly">매년</option>
                    </select>
                    <div id="recurrenceOptions" style="display: none; margin-top: 10px;">
                        <label class="field-label" style="margin-bottom: 5px;">반복 종료 날짜</label>
                        <input type="date" id="eventRecurrenceEndDate" class="field-input">
                    </div>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-align-left"></i>
                        설명
                    </label>
                    <textarea id="eventDescription" class="field-textarea" placeholder="일정에 대한 설명을 입력하세요" rows="4"></textarea>
                </div>

                <div class="panel-actions">
                    <button type="button" class="btn btn-delete" id="deleteEventBtn">
                        <i class="fas fa-trash"></i>
                        삭제
                    </button>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-cancel" id="cancelEventBtn">취소</button>
                        <button type="submit" class="btn btn-save">저장</button>
                    </div>
                </div>
            </form>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="quickEventModal">
    <div class="modal-content small">
        <div class="modal-header">
            <h3>새 일정 추가</h3>
            <button class="icon-btn" id="closeQuickModalBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="quickEventForm">
                <input type="hidden" id="quickEventDate">
                <div class="form-field">
                    <label class="field-label">일정 제목</label>
                    <input type="text" id="quickEventTitle" class="field-input" placeholder="일정 제목 입력" required autofocus>
                </div>
                <div class="form-field">
                    <label class="field-label">카테고리</label>
                    <select id="quickEventCategory" class="field-select" required>
                        </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="quickDetailBtn">상세 설정</button>
                    <button type="submit" class="btn btn-save">추가</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal-overlay" id="categoryModalOverlay">
    <div class="modal-content small">
        <div class="modal-header">
            <h3>새 카테고리 추가</h3>
            <button class="icon-btn" id="closeCategoryModalBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="categoryForm">
                <div class="form-field">
                    <label class="field-label">카테고리 이름</label>
                    <input type="text" id="categoryName" class="field-input" placeholder="예: 개인, 공부, 운동" required>
                </div>
                <div class="form-field">
                    <label class="field-label">색상 선택</label>
                    <div class="color-picker" id="colorPicker">
                        <button type="button" class="color-option" data-color="#D32F2F" style="background: #D32F2F"></button>
                        <button type="button" class="color-option" data-color="#C2185B" style="background: #C2185B"></button>
                        <button type="button" class="color-option" data-color="#7B1FA2" style="background: #7B1FA2"></button>
                        <button type="button" class="color-option" data-color="#512DA8" style="background: #512DA8"></button>
                        <button type="button" class="color-option" data-color="#303F9F" style="background: #303F9F"></button>
                        <button type="button" class="color-option active" data-color="#1976D2" style="background: #1976D2"></button>
                        <button type="button" class="color-option" data-color="#0288D1" style="background: #0288D1"></button>
                        <button type="button" class="color-option" data-color="#0097A7" style="background: #0097A7"></button>
                        <button type="button" class="color-option" data-color="#00796B" style="background: #00796B"></button>
                        <button type="button" class="color-option" data-color="#388E3C" style="background: #388E3C"></button>
                        <button type="button" class="color-option" data-color="#689F38" style="background: #689F38"></button>
                        <button type="button" class="color-option" data-color="#F57C00" style="background: #F57C00"></button>
                        <button type="button" class="color-option" data-color="#E64A19" style="background: #E64A19"></button>
                        <button type="button" class="color-option" data-color="#5D4037" style="background: #5D4037"></button>
                        <button type="button" class="color-option" data-color="#616161" style="background: #616161"></button>
                        <button type="button" class="color-option" data-color="#455A64" style="background: #455A64"></button>
                    </div>
                    <input type="hidden" id="categoryColor" value="#1976D2">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelCategoryBtn">취소</button>
                    <button type="submit" class="btn btn-save">추가</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
{% endblock %}