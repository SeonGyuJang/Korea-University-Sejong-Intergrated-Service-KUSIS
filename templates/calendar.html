{% extends "base.html" %}

{% block title %}Ï∫òÎ¶∞Îçî - KUSIS{% endblock %}

{% block styles %}
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
{% endblock %}

{% block content %}
<div class="notion-calendar-container">
    <div class="calendar-sidebar">
        <div class="mini-calendar-wrapper">
            <div class="mini-calendar-header">
                <button class="mini-nav-btn" id="miniPrevMonth">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="mini-calendar-title" id="miniCalendarTitle">2025ÎÖÑ 10Ïõî</span>
                <button class="mini-nav-btn" id="miniNextMonth">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div id="miniCalendar" class="mini-calendar"></div>
            <button class="today-btn" id="todayBtn">
                <i class="fas fa-calendar-day"></i> Ïò§Îäò
            </button>
        </div>

        <div class="sidebar-section">
            <div class="section-header">
                <h3>ÎÇ¥ Ï∫òÎ¶∞Îçî</h3>
                <button class="icon-btn" id="addCategoryBtn" title="Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="category-list" id="categoryList">
                </div>
        </div>
    </div>

    <div class="calendar-main">
        <div class="calendar-toolbar">
            <div class="toolbar-left">
                <h1 class="calendar-main-title" id="calendarMainTitle">2025ÎÖÑ 10Ïõî</h1>
            </div>
            <div class="toolbar-right">
                <div class="view-switcher">
                    <button class="view-btn" data-view="dayGridMonth">Ïõî</button>
                    <button class="view-btn active" data-view="timeGridWeek">Ï£º</button>
                    <button class="view-btn" data-view="timeGridDay">Ïùº</button>
                </div>
            </div>
        </div>

        <div id="calendar" class="main-calendar"></div>
    </div>

    <div class="side-panel" id="sidePanel"> {# --- ÏàòÏ†ï: always-visible ÌÅ¥ÎûòÏä§ Ï†úÍ±∞ --- #}
        <div class="panel-default-view" id="panelDefaultView">
            <div class="side-panel-header">
                <h2>üìå Î∞îÎ°úÍ∞ÄÍ∏∞</h2>
            </div>
            <div class="side-panel-body">
                <div class="shortcuts-section">
                    <h3>‚å®Ô∏è ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§</h3>
                    <div class="shortcut-list">
                        <div class="shortcut-item">
                             <kbd>ESC</kbd>
                            <span>Ìå®ÎÑê/Î™®Îã¨ Îã´Í∏∞</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>\</kbd>
                            <span>Ï¢åÏ∏° ÏÇ¨Ïù¥ÎìúÎ∞î Ïó¥Í∏∞/Îã´Í∏∞</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>N</kbd>
                            <span>ÏÉà ÏùºÏ†ï</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>T</kbd>
                            <span>Ïò§ÎäòÎ°ú Ïù¥Îèô</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>W</kbd>
                            <span>Ï£ºÍ∞Ñ Î∑∞</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>M</kbd>
                            <span>ÏõîÍ∞Ñ Î∑∞</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>D</kbd>
                            <span>ÏùºÍ∞Ñ Î∑∞</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>‚Üê</kbd> <kbd>‚Üí</kbd>
                            <span>Ïù¥Ï†Ñ/Îã§Ïùå</span>
                        </div>
                    </div>
                </div>

                <div class="tips-section">
                    <h3>üí° ÏÇ¨Ïö© ÌåÅ</h3>
                    <ul class="tips-list">
                        <li>Îπà ÏãúÍ∞ÑÏùÑ <strong>ÎìúÎûòÍ∑∏</strong>ÌïòÏó¨ ÏùºÏ†ï ÏÉùÏÑ±</li>
                        <li>ÏùºÏ†ïÏùÑ <strong>ÎìúÎûòÍ∑∏</strong>ÌïòÏó¨ Ïù¥Îèô</li>
                        <li>ÏùºÏ†ï Í≤ΩÍ≥ÑÎ•º <strong>ÎìúÎûòÍ∑∏</strong>ÌïòÏó¨ ÏãúÍ∞Ñ Ï°∞Ï†à</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="panel-edit-view" id="panelEditView" style="display: none;">
            <div class="side-panel-header">
                <h2>ÏùºÏ†ï Ï†ïÎ≥¥</h2>
                <button class="icon-btn close-panel-btn" id="closePanelBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="side-panel-body">
                <form id="eventForm">
                <input type="hidden" id="eventId">

                <div class="form-field">
                    <input type="text" id="eventTitle" class="title-input" placeholder="ÏùºÏ†ï Ï†úÎ™© ÏûÖÎ†•" required>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-tag"></i>
                        Ïπ¥ÌÖåÍ≥†Î¶¨
                    </label>
                    <select id="eventCategory" class="field-select" required>
                        </select>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-clock"></i>
                        ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ
                    </label>
                    <label class="checkbox-label" style="margin-bottom: 10px;">
                        <input type="checkbox" id="eventAllDay" checked>
                        <span>Ï¢ÖÏùº</span>
                    </label>
                    <div class="date-time-grid">
                        <input type="date" id="eventStartDate" class="field-input" placeholder="ÏãúÏûë ÎÇ†Ïßú" required>
                        <input type="time" id="eventStartTime" class="field-input time-input" placeholder="ÏãúÏûë ÏãúÍ∞Ñ" style="display: none;">
                        <input type="date" id="eventEndDate" class="field-input" placeholder="Ï¢ÖÎ£å ÎÇ†Ïßú (ÏÑ†ÌÉù)">
                        <input type="time" id="eventEndTime" class="field-input time-input" placeholder="Ï¢ÖÎ£å ÏãúÍ∞Ñ" style="display: none;">
                    </div>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-redo"></i>
                        Î∞òÎ≥µ
                    </label>
                    <select id="eventRecurrence" class="field-select">
                        <option value="">Î∞òÎ≥µ Ïïà Ìï®</option>
                        <option value="daily">Îß§Ïùº</option>
                        <option value="weekly">Îß§Ï£º</option>
                        <option value="monthly">Îß§Ïõî</option>
                        <option value="yearly">Îß§ÎÖÑ</option>
                    </select>
                    <div id="recurrenceOptions" style="display: none; margin-top: 10px;">
                        <label class="field-label" style="margin-bottom: 5px;">Î∞òÎ≥µ Ï¢ÖÎ£å ÎÇ†Ïßú</label>
                        <input type="date" id="eventRecurrenceEndDate" class="field-input">
                    </div>
                </div>

                <div class="form-field">
                    <label class="field-label">
                        <i class="fas fa-align-left"></i>
                        ÏÑ§Î™Ö
                    </label>
                    <textarea id="eventDescription" class="field-textarea" placeholder="ÏùºÏ†ïÏóê ÎåÄÌïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" rows="4"></textarea>
                </div>

                <div class="panel-actions">
                    <button type="button" class="btn btn-delete" id="deleteEventBtn">
                        <i class="fas fa-trash"></i>
                        ÏÇ≠Ï†ú
                    </button>
                    <div class="action-buttons">
                        <button type="button" class="btn btn-cancel" id="cancelEventBtn">Ï∑®ÏÜå</button>
                        <button type="submit" class="btn btn-save">Ï†ÄÏû•</button>
                    </div>
                </div>
            </form>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="quickEventModal">
    <div class="modal-content small">
        <div class="modal-header">
            <h3>ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä</h3>
            <button class="icon-btn" id="closeQuickModalBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="quickEventForm">
                <input type="hidden" id="quickEventDate">
                <div class="form-field">
                    <label class="field-label">ÏùºÏ†ï Ï†úÎ™©</label>
                    <input type="text" id="quickEventTitle" class="field-input" placeholder="ÏùºÏ†ï Ï†úÎ™© ÏûÖÎ†•" required autofocus>
                </div>
                <div class="form-field">
                    <label class="field-label">Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                    <select id="quickEventCategory" class="field-select" required>
                        </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="quickDetailBtn">ÏÉÅÏÑ∏ ÏÑ§Ï†ï</button>
                    <button type="submit" class="btn btn-save">Ï∂îÍ∞Ä</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal-overlay" id="categoryModalOverlay">
    <div class="modal-content small">
        <div class="modal-header">
            <h3>ÏÉà Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä</h3>
            <button class="icon-btn" id="closeCategoryModalBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="categoryForm">
                <div class="form-field">
                    <label class="field-label">Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶Ñ</label>
                    <input type="text" id="categoryName" class="field-input" placeholder="Ïòà: Í∞úÏù∏, Í≥µÎ∂Ä, Ïö¥Îèô" required>
                </div>
                <div class="form-field">
                    <label class="field-label">ÏÉâÏÉÅ ÏÑ†ÌÉù</label>
                    <div class="color-picker" id="colorPicker">
                        <button type="button" class="color-option" data-color="#D32F2F" style="background: #D32F2F"></button>
                        <button type="button" class="color-option" data-color="#C2185B" style="background: #C2185B"></button>
                        <button type="button" class="color-option" data-color="#7B1FA2" style="background: #7B1FA2"></button>
                        <button type="button" class="color-option" data-color="#512DA8" style="background: #512DA8"></button>
                        <button type="button" class="color-option" data-color="#303F9F" style="background: #303F9F"></button>
                        <button type="button" class="color-option active" data-color="#1976D2" style="background: #1976D2"></button>
                        <button type="button" class="color-option" data-color="#0288D1" style="background: #0288D1"></button>
                        <button type="button" class="color-option" data-color="#0097A7" style="background: #0097A7"></button>
                        <button type="button" class="color-option" data-color="#00796B" style="background: #00796B"></button>
                        <button type="button" class="color-option" data-color="#388E3C" style="background: #388E3C"></button>
                        <button type="button" class="color-option" data-color="#689F38" style="background: #689F38"></button>
                        <button type="button" class="color-option" data-color="#F57C00" style="background: #F57C00"></button>
                        <button type="button" class="color-option" data-color="#E64A19" style="background: #E64A19"></button>
                        <button type="button" class="color-option" data-color="#5D4037" style="background: #5D4037"></button>
                        <button type="button" class="color-option" data-color="#616161" style="background: #616161"></button>
                        <button type="button" class="color-option" data-color="#455A64" style="background: #455A64"></button>
                    </div>
                    <input type="hidden" id="categoryColor" value="#1976D2">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" id="cancelCategoryBtn">Ï∑®ÏÜå</button>
                    <button type="submit" class="btn btn-save">Ï∂îÍ∞Ä</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
{% endblock %}